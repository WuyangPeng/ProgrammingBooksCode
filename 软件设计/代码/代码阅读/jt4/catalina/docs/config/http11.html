<html>
<head>
<title>The 'HTTP/1.1 Connector' Component</title>
</head>
<body bgcolor="white">

<div align="center">
<h1>The <u>HTTP/1.1 Connector</u> Component</h1>
<br>
<a href="#Introduction">[Introduction]</a>
<a href="#Component Attributes">[Component Attributes]</a>
<a href="#Special Features">[Special Features]</a>
</br>
</div>


<a name="Introduction"></a>
<h2>Introduction</h2>

<p>The <strong>HTTP/1.1 Connector</strong> component is a
<strong>Connector</strong> implementation that supports the
HTTP/1.1 protocol.  It enables Catalina to
function as a stand-alone web server, in addition to its ability to execute
servlets and serve JSP pages.  A particular instance of this component
listens for connections on a configured TCP/IP port number on the server.
One or more such connectors can be configured, each forwarding requests to
a particular <a href="engine.html">Engine</a> for processing.</p>

<p>This Connector is configured by including a
<code>&lt;Connector&gt;</code> element in your <code>conf/server.xml</code>
configuration file, nested inside a <a href="service.html">Service</a> element.
All connectors that you have configured are automatically attached to the
<a href="engine.html">Engine</a> that is specified after the connector.</p>

<p>At server startup time, this Connector will create a number of processor
threads (based on the value of the <code>minProcessors</code> property).  Each
incoming request requires a thread, and the associated processor, for the
duration of that request.  If more simultaneous requests are received than
can be handled by the current set of available processors, additional threads
(and associated processors) will be created up to the configured value of the
<code>maxProcessors</code> property, which defines the maximum number of
simultaneous requests this connector is allowed to process.</p>

<br>


<a name="Component Attributes"></a>
<h2>Component Attributes</h2>

<p>The <strong>HTTP/1.1 Connector</strong> supports the following attributes:
</p>

<table border="1" width="100%">

  <tr>
    <th width="15%">Attribute</th>
    <th width="85%">Description</th>
  </tr>

  <tr>
    <td><code>acceptCount</code></td>
    <td>
      The maximum queue length for incoming connection indications that will
      be allowed on our server socket.  If a connection indication arrives
      when the queue is full, the connection is refused.  If not specfied, a
      backlog of 10 will be allowed.
    </td>
  </tr>

  <tr>
    <td><code>address</code></td>
    <td>
      For servers with more than one IP address, this property specifies which
      address will be used for listening on the specified port.  If not
      specified, this port number will be used on all IP addresses associated
      with this server.
    </td>
  </tr>

  <tr>
    <td><code>bufferSize</code></td>
    <td>
      The size (in bytes) of the buffer to be provided for input streams
      created by this connector.  Increasing the buffer size can improve
      performance, at the expense of higher memory usage.  If not specified,
      a buffer size of 2048 bytes will be provided.
    </td>
  </tr>

  <tr>
    <td><code>className</code></td>
    <td>
      Java class name of the implementation to use.  Must be specified
      as <code>org.apache.tomcat.connector.http.HttpConnector</code>
      to use the standard implementation.
    </td>
  </tr>

  <tr>
    <td><code>debug</code></td>
    <td>
      The debugging detail level of log messages generated by this connector,
      where higher numbers create more detailed output.  If not specified,
      the debugging detail level will be set to zero (0).
    </td>
  </tr>

  <tr>
    <td><code>enableLookups</code></td>
    <td>
      Set this attribute to <code>true</code> to enable DNS lookups of the
      remote host name when <code>request.getRemoteHost()</code> is called.
      If lookups are disabled, the remote IP address (as a String) is
      returned instead.  By default, DNS lookups are enabled.
    </td>
  </tr>

  <tr>
    <td><code>maxProcessors</code></td>
    <td>
      The maximum number of processor threads that will ever be created by
      this Connector, which therefore determines the maximum number of
      simultaneous requests that can be handled.  If not specified, the
      maximum will be set to 20.
    </td>
  </tr>

  <tr>
    <td><code>minProcessors</code></td>
    <td>
      The number of processor threads that will be initialized when this
      Connector is first started.  If not specified, 5 processors will be
      initialized.
    </td>
  </tr>

  <tr>
    <td><code>port</code></td>
    <td>
      The TCP/IP port number on which this connector should listen for
      client connections.  Your operating system will allow only one server
      application to listen to a particular port at a particular time.
      If not specified, port 8080 will be used.
    </td>
  </tr>

  <tr>
    <td><code>proxyName</code></td>
    <td>
      If specified, this value will be used as the value returned by
      <code>request.getServerName()</code>, instead of the value included
      on the <code>Host</code> header.  This is useful when running Tomcat
      behind a proxy server (or a web server acting as a proxy server)
      on a different host.  See
      <a href="#Proxy Support">Proxy Support</a>, below, for more
      information on running behind a proxy server.
    </td>
  </tr>

  <tr>
    <td><code>proxyPort</code></td>
    <td>
      If specified, this value will be used as the value returned by
      <code>request.getServerPort()</code>, instead of the value specified
      by the <code>port</code> attribute.  This is useful when running
      Tomcat behind a proxy server (or a web server acting as a proxy server).
      See <a href="#Proxy Support">Proxy Support</a>, below, for more
      information about running behind a proxy server.
    </td>
  </tr>

</table>

<br>


<a name="Special Features"></a>
<h2>Special Features</h2>

<h3>HTTP/1.1 and HTTP/1.0 Protocol Support</h3>

<p>This Connector supports all of the required features of the HTTP/1.1
protocol as described in RFC 2616, including persistent connections and
chunked encoding.  If the client (typically a browser) supports only HTTP/1.0,
the Connector gracefully falls back to supporting this as well, so that
interoperability is maximized.  No special configuration is required to
enable this support.</p>

<h3>Logging Output</h3>

<p>Any debugging or exception logging information generated by this Connector
will be sent to the <a href="logger.html">Logger</a> associated with the
<a href="engine.html">Engine</a> which is used to process requests for
this Connector.</p>

<h3>SSL Support</h3>

<p>You can enable SSL support for an instance of this
<strong>Connector</strong> by configuring an appropriate socket factory,
as follows:</p>

<table border="1" width="100%">

  <tr>
    <th width="15%">Attribute</th>
    <th width="85%">Description</th>
  </tr>

  <tr>
    <td><code>algorithm</code></td>
    <td>
      The certificate encoding algorithm to be used.  If not specified, the
      default value is <code>SunX509</code>.
    </td>
  </tr>

  <tr>
    <td><code>className</code></td>
    <td>
      The fully qualified Java class name of the SSL socket factory.  With the
      standard <strong>HTTP 1.1</strong> connectory, you must specify
      <code>org.apache.catalina.net.SSLServerSocketFactory</code> here.
    </td>
  </tr>

  <tr>
    <td><code>clientAuth</code></td>
    <td>
      Set to <code>true</code> if you want the SSL stack to require a valid
      certificate chain from the client before accepting a connection.  A
      <code>false</code> value (which is the default) will not require such
      a certificate chain.
    </td>
  </tr>

  <tr>
    <td><code>keystoreFile</code></td>
    <td>
      The pathname of the keystore file from which the server certificate is
      loaded.  By default, the pathname is the file ".keystore" in the home
      directory of the operating system username that is running Tomcat.
    </td>
  </tr>

  <tr>
    <td><code>keystorePass</code></td>
    <td>
      The password used to access the server certificate from the keystore
      file identified above.  If not specified, the default value is
      "changeit".
    </td>
  </tr>

  <tr>
    <td><code>keystoreType</code></td>
    <td>
      The type of keystore file to be used for the server certificate.  If
      not specified, the default value is "JKS".
    </td>
  </tr>

  <tr>
    <td><code>protocol</code></td>
    <td>
      The version of the SSL protocol to use.  If not specified, the default
      value is "TLS".
    </td>
  </tr>

</table>

<p>Successful use of SSL support requires that you have installed the JAR
files from the Java Secure Sockets Extension (JSSE) package into your
<code>conf/server</code> directory.</p>

<a name="Proxy Support"></a>
<h3>Proxy Support</h3>

<p>The <code>proxyName</code> and <code>proxyPort</code> attributes can be used
when Tomcat is run behind a proxy server.  These attributes modify the values
returned to web applications by the <code>request.getServerName()</code> and
<code>request.getServerPort()</code> methods, which are often used to construct
absolute URLs for redirects.  Using the modified values will cause redirected
requests to be flowed through the proxy server as well, instead of directly to
the port on which Tomcat is listening.</p>

<p>Proxy support can take many forms.  The following outline assumes that you
are running Tomcat behind an Apache web server (listening to port 80) on the
same server that Tomcat is running on, and you wish to have all requests flow
through Apache, but forward requests for a particular web application to
Tomcat for processing.</p>
<ul>
<li>Configure your copy of Apache so that it includes the
    <code>mod_proxy</code> module.  If you are building from source, the
    easiest way to do this is to include the <code>--enable-module=proxy</code>
    directive on the <code>./configure</code> command line.</li>
<li>Include two directives in your <code>httpd.conf</code> file for each
    web application that you wish to forward to Tomcat.  For example:
    <pre>
        ProxyPass         /myapp  http://localhost:8081/myapp
        ProxyPassReverse  /myapp  http://localhost:8081/myapp
    </pre>
    tells Apache to forward all requests sent to URLs like
    <code>http://localhost/myapp/*</code> to be forwarded the Tomcat
    connector listening on port 8081.</li>
<li>Configure your copy of Tomcat to have a special Connector listening
    on port 8081, with appropriate proxy settings as shown below:
    <pre>
        &lt;Connector className="org.apache.catalina.connector.http.HttpConnector"
         port="8081" ... proxyPort="80" proxyName="www.mycompany.com"/&gt;
    </pre>
    which will cause servlets in this web app to think that the request
    was directed to <code>www.mycompany.com</code> on port <code>80</code>.
    </li>
<li>It is legal to omit the <code>proxyName</code> attribute from the
    <code>&lt;Connector&gt;</code> element.  If you do so, the value
    reported by the <code>request.getServerName()</code> method will be
    the hostname to which Apache forwards (in the configuration described
    above, it would be "localhost").</li>
<li>If you also have a Tomcat connector listening on port 8080 (within the
    same <code>&lt;Service&gt;</code>, the requests to either port will be
    processed by exactly the same set of web applications.  You might want
    to use the IP filtering features of your operating system to restrict
    connections for port 8081 to come from <em>only</em> the local host
    (which is presumably the Apache web server).</li>
<li>Alternatively, you can set up a series of web applications that are
    <em>only</em> available via proxying as follows:
    <ul>
    <li>Configure another <code>&lt;Service&gt;</code> that contains a
        <code>&lt;Connector&gt;</code> configured for proxying, as above.</li>
    <li>Configure appropriate <code>&lt;Engine&gt;</code>,
        <code>&lt;Host&gt;</code>, and <code>&lt;Context&gt;</code>
        entries for the web applications accessible via proxying.</li>
    <li>Optionally, protect port 8081 with IP filters as described earlier.
        </li>
    </ul>
<li>When requests are proxied from Apache, the web server will be recording
    these requests in its access log.  Therefore, you will generally want to
    disable any access logging done by Tomcat (by removing or commenting out
    the <code>&lt;Valve&gt;</code> line).</li>
</ul>

<p><strong>NOTE</strong> - Unlike the usual situation when Tomcat is used
behind a web connector, Tomcat will serve <em>all</em> requests (including
static files) for the specified web application.</p>

<br>

</body>
</html>
