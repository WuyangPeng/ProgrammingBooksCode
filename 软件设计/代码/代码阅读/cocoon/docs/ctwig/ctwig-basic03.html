<html xmlns:NetUtils="org.apache.cocoon.util.NetUtils">
<head>
<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>cTwIG - Cocoon Two Idiots Guide - Basic XSP/Logicsheet Processing</title>
<script type="text/javascript" src="resources/script.js" language="JavaScript"></script>
</head>
<body bgcolor="#ffffff" marginheight="4" marginwidth="4" leftmargin="4" topmargin="4" alink="#cc0000" vlink="#0086b2" link="#039acc" text="#000000">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td align="left" valign="top" rowspan="3" height="60" width="135"><img border="0" vspace="0" hspace="0" src="images/logo.gif" height="60" width="135"></td><td background="images/line.gif" colspan="2" align="left" valign="top" height="5" width="100%"><img align="left" border="0" vspace="0" hspace="0" src="images/line.gif" height="5" width="1"></td><td align="left" valign="top" rowspan="3" height="60" width="29"><img border="0" vspace="0" hspace="0" src="images/right.gif" height="60" width="29"></td>
</tr>
<tr>
<td bgcolor="#0086b2" colspan="2" align="right" valign="top" height="35" width="100%"><img align="right" alt="cTwIG - Cocoon Two Idiots Guide - Basic XSP/Logicsheet Processing" border="0" vspace="0" hspace="0" src="graphics/ctwig-basic03-header.jpg_label=cTwIG%20-%20Cocoon%20Two%20Idiots%20Guide%20-%20Basic%20XSP/Logicsheet%20Processing.jpg"></td>
</tr>
<tr>
<td background="images/bottom.gif" bgcolor="#0086b2" align="left" valign="top" height="20" width="100%"><img align="left" border="0" vspace="0" hspace="0" src="images/bottom.gif" height="20" width="3"></td><td background="images/bottom.gif" width="288" valign="top" height="20" bgcolor="#0086b2" align="right">
<table width="288" cellspacing="0" cellpadding="0" border="0">
<tr>
<td align="left" valign="top" height="20" width="96"><a onMouseOver="rolloverOn('xml');" onMouseOut="rolloverOff('xml');" target="new" href="http://xml.apache.org/"><img onLoad="rolloverLoad('xml', 'images/button-xml-hi.gif', 'images/button-xml-lo.gif');" border="0" vspace="0" hspace="0" name="xml" src="images/button-xml-lo.gif" height="20" width="96" alt="http://xml.apache.org/"></a></td><td align="left" valign="top" height="20" width="96"><a onMouseOver="rolloverOn('asf');" onMouseOut="rolloverOff('asf');" target="new" href="http://www.apache.org/"><img onLoad="rolloverLoad('asf', 'images/button-asf-hi.gif', 'images/button-asf-lo.gif');" border="0" vspace="0" hspace="0" name="asf" src="images/button-asf-lo.gif" height="20" width="96" alt="http://www.apache.org/"></a></td><td align="left" valign="top" height="20" width="96"><a onMouseOver="rolloverOn('w3c');" onMouseOut="rolloverOff('w3c');" target="new" href="http://www.w3.org/"><img onLoad="rolloverLoad('w3c', 'images/button-w3c-hi.gif', 'images/button-w3c-lo.gif');" border="0" vspace="0" hspace="0" name="w3c" src="images/button-w3c-lo.gif" height="20" width="96" alt="http://www.w3.org/"></a></td>
</tr>
</table>
</td>
</tr>
</table>
<table width="100%" cellspacing="0" cellpadding="0" border="0">
<tr width="100%">
<td valign="top" width="120">
<table width="120" cellspacing="0" cellpadding="0" border="0">
<tr>
<td valign="top" align="left"><img width="120" vspace="0" src="images/join.gif" hspace="0" height="14" border="0"><br>
</td>
</tr>
<tr>
<td valign="top" align="left"><a onMouseOver="rolloverOn('Main')" onMouseOut="rolloverOff('Main')" href="../index.html"><img onLoad="rolloverLoad('Main', 'graphics/Main-label_over.jpg', 'graphics/Main-label.jpg');" vspace="0" hspace="0" name="Main" width="120" height="12" border="0" src="graphics/Main-label.jpg" alt="Main"></a></td>
</tr>
<tr>
<td valign="top" align="left"><img alt="cTwIG" width="120" vspace="0" src="graphics/cTwIG-separator.jpg" hspace="0" height="20" border="0"><br>
</td>
</tr>
<tr>
<td valign="top" align="left"><a onMouseOver="rolloverOn('Home')" onMouseOut="rolloverOff('Home')" href="index.html"><img onLoad="rolloverLoad('Home', 'graphics/Home-label_over.jpg', 'graphics/Home-label.jpg');" vspace="0" hspace="0" name="Home" width="120" height="12" border="0" src="graphics/Home-label.jpg" alt="Home"></a></td>
</tr>
<tr>
<td valign="top" align="left"><a onMouseOver="rolloverOn('Why')" onMouseOut="rolloverOff('Why')" href="ctwig-why.html"><img onLoad="rolloverLoad('Why', 'graphics/Why-label_over.jpg', 'graphics/Why-label.jpg');" vspace="0" hspace="0" name="Why" width="120" height="12" border="0" src="graphics/Why-label.jpg" alt="Why"></a></td>
</tr>
<tr>
<td valign="top" align="left"><a onMouseOver="rolloverOn('Getting Started')" onMouseOut="rolloverOff('Getting Started')" href="ctwig-gettingstarted.html"><img onLoad="rolloverLoad('Getting Started', 'graphics/Getting%20Started-label_over.jpg', 'graphics/Getting%20Started-label.jpg');" vspace="0" hspace="0" name="Getting Started" width="120" height="12" border="0" src="graphics/Getting%20Started-label.jpg" alt="Getting Started"></a></td>
</tr>
<tr>
<td valign="top" align="left"><a onMouseOver="rolloverOn('Installing')" onMouseOut="rolloverOff('Installing')" href="ctwig-installing.html"><img onLoad="rolloverLoad('Installing', 'graphics/Installing-label_over.jpg', 'graphics/Installing-label.jpg');" vspace="0" hspace="0" name="Installing" width="120" height="12" border="0" src="graphics/Installing-label.jpg" alt="Installing"></a></td>
</tr>
<tr>
<td valign="top" align="left"><a onMouseOver="rolloverOn('Transformations')" onMouseOut="rolloverOff('Transformations')" href="ctwig-transformations.html"><img onLoad="rolloverLoad('Transformations', 'graphics/Transformations-label_over.jpg', 'graphics/Transformations-label.jpg');" vspace="0" hspace="0" name="Transformations" width="120" height="12" border="0" src="graphics/Transformations-label.jpg" alt="Transformations"></a></td>
</tr>
<tr>
<td valign="top" align="left"><a onMouseOver="rolloverOn('Resources')" onMouseOut="rolloverOff('Resources')" href="ctwig-resources.html"><img onLoad="rolloverLoad('Resources', 'graphics/Resources-label_over.jpg', 'graphics/Resources-label.jpg');" vspace="0" hspace="0" name="Resources" width="120" height="12" border="0" src="graphics/Resources-label.jpg" alt="Resources"></a></td>
</tr>
<tr>
<td valign="top" align="left"><a onMouseOver="rolloverOn('Contributing')" onMouseOut="rolloverOff('Contributing')" href="ctwig-contributing.html"><img onLoad="rolloverLoad('Contributing', 'graphics/Contributing-label_over.jpg', 'graphics/Contributing-label.jpg');" vspace="0" hspace="0" name="Contributing" width="120" height="12" border="0" src="graphics/Contributing-label.jpg" alt="Contributing"></a></td>
</tr>
<tr>
<td align="left" valign="top"><img width="120" vspace="0" src="images/close.gif" hspace="0" height="14" border="0"><br>
</td>
</tr>
</table>
</td><td>
<table cellspacing="0" cellpadding="0" border="0">
<tr>
<td height="10" width="100%"></td>
</tr>
<tr>
<td>
	

	
		
<div align="right">
<table cellpadding="0" cellspacing="0" width="98%" border="0">
<tr>
<td align="right" valign="bottom" height="7" width="9"><img border="0" hspace="0" vspace="0" height="7" width="9" src="images/bar-top-left.gif"></td><td background="images/bar-border-top.gif"><img border="0" hspace="0" vspace="0" height="5" width="1" src="images/void.gif"></td><td align="left" valign="bottom" height="7" width="9"><img border="0" hspace="0" vspace="0" height="7" width="9" src="images/bar-top-right.gif"></td>
</tr>
<tr>
<td background="images/bar-border-left.gif" width="9"><img border="0" hspace="0" vspace="0" height="1" width="9" src="images/void.gif"></td><td bgcolor="#0086b2" width="100%"><font color="#ffffff" face="arial,helvetica,sanserif" size="+1"><img border="0" hspace="0" vspace="0" height="5" width="5" src="images/void.gif"><b>Transformations</b></font></td><td background="images/bar-border-right.gif" width="9"><img border="0" hspace="0" vspace="0" height="1" width="9" src="images/void.gif"></td>
</tr>
<tr>
<td align="right" valign="top" height="12" width="9"><img border="0" hspace="0" vspace="0" height="12" width="9" src="images/bar-bottom-left.gif"></td><td background="images/bar-border-bottom.gif"><img border="0" hspace="0" vspace="0" height="12" src="images/void.gif"></td><td align="left" valign="top" height="12" width="9"><img border="0" hspace="0" vspace="0" height="12" width="9" src="images/bar-bottom-right.gif"></td>
</tr>
</table>
<table cellpadding="0" cellspacing="0" width="98%" border="0">
<tr>
<td><font color="#000000" face="arial,helvetica,sanserif">
			
<div align="right">
<table cellpadding="0" cellspacing="0" width="95%" border="0">
<tr>
<td align="right" valign="bottom" height="7" width="9"><img border="0" hspace="0" vspace="0" height="7" width="9" src="images/bar-top-left.gif"></td><td background="images/bar-border-top.gif"><img border="0" hspace="0" vspace="0" height="5" width="1" src="images/void.gif"></td><td align="left" valign="bottom" height="7" width="9"><img border="0" hspace="0" vspace="0" height="7" width="9" src="images/bar-top-right.gif"></td>
</tr>
<tr>
<td background="images/bar-border-left.gif" width="9"><img border="0" hspace="0" vspace="0" height="1" width="9" src="images/void.gif"></td><td bgcolor="#0086b2" width="100%"><font color="#ffffff" face="arial,helvetica,sanserif"><img border="0" hspace="0" vspace="0" height="5" width="5" src="images/void.gif"><b>Basic XSP/Logicsheet Processing</b></font></td><td background="images/bar-border-right.gif" width="9"><img border="0" hspace="0" vspace="0" height="1" width="9" src="images/void.gif"></td>
</tr>
<tr>
<td align="right" valign="top" height="12" width="9"><img border="0" hspace="0" vspace="0" height="12" width="9" src="images/bar-bottom-left.gif"></td><td background="images/bar-border-bottom.gif"><img border="0" hspace="0" vspace="0" height="12" width="1" src="images/void.gif"></td><td align="left" valign="top" height="12" width="9"><img border="0" hspace="0" vspace="0" height="12" width="9" src="images/bar-bottom-right.gif"></td>
</tr>
</table>
<table cellpadding="0" cellspacing="0" width="95%" border="0">
<tr>
<td><font color="#000000" face="arial,helvetica,sanserif">
				
<p align="justify">By allowing you to wrap logic up in the XML page, C2 has given us a route to remove the logic from the presentation yet get the advantages of having a dynamic pages serving technology.  The only issue is that it effectively just shifts the maintenance headache into yet another part of the architecture.  The C2 developers have been dead bright however and incorporated the idea of a logicsheet to solve this problem.</p>
				
<p align="justify">A logicsheet allows you to take the logic out of the XSP page and put it into a seperate stylesheet.  You then identify the logic and reference the identifier from your XML file.  C2, using basic XML/XSL transforming logic, then takes care of replacing the reference to the logic in the XML with the actual logic from the logicsheet when the XSP file is processed.  The resultant XML stream can then be rendered using an XSL stylesheet as normal.  The main benefits are that:</p>
				
<blockquote>
<ul>
					
<li>XML data files are not made confused with the addition of complex logic</li>
					
<li>Libraries of logic can be built up and reused</li>
					
<li>Maintenance of logic is made easier</li>
					
<li>It is really cool to do!</li>
				
</ul>
</blockquote>
				
<p align="justify">Take the following example XSP page (<a target="_blank" href="sample/transformations/basic03/basic03-01.xml.txt">basic03-01.xml</a>) that refers to a logicsheet:</p>
				
<div align="center">
<table border="0" cellpadding="0" cellspacing="4">
<tr>
<td height="1" width="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td><td height="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td><td height="1" width="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td>
</tr>
<tr>
<td width="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td><td bgcolor="#ffffff">
<pre>
&lt;?xml version="1.0"?&gt;
&lt;xsp:page 
	xmlns:xsp="http://apache.org/xsp"
  xmlns:ctwig="http://www.pigbite.com/xsl"
&gt;

&lt;page&gt;
  &lt;title&gt;
    Basic XSP/Logicsheet Processing Example - BASIC03-01.XML
  &lt;/title&gt;
  &lt;greeting&gt;
    &lt;ctwig:greeting/&gt;
  &lt;/greeting&gt;
&lt;/page&gt;
&lt;/xsp:page&gt;</pre>
</td><td width="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td>
</tr>
<tr>
<td height="1" width="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td><td height="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td><td height="1" width="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td>
</tr>
</table>
</div>
				
<p align="justify">The only difference between this and the previous example is that we have added a new namespace reference to the logicsheet (xmlns:ctwig="http://www.pigbite.com/xsl") and replace the logic with a reference to the an id, effectively analogous to a command or function call, in the the logicsheet (&lt;ctwig:greeting/&gt;).  Whatever ctwig:greeting does will replace the reference, which is sitting inside the &lt;greeting&gt; tag.</p>
				
<p align="justify">The logicsheet looks like this (<a target="_blank" href="sample/transformations/logicsheet/ctwig.xsl.txt">ctwig.xsl</a>):</p>
				
<div align="center">
<table border="0" cellpadding="0" cellspacing="4">
<tr>
<td height="1" width="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td><td height="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td><td height="1" width="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td>
</tr>
<tr>
<td width="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td><td bgcolor="#ffffff">
<pre>
&lt;?xml version="1.0"?&gt;
&lt;xsl:stylesheet
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:xsp="http://apache.org/xsp"
  xmlns:ctwig="http://www.pigbite.com/xsl"
  version="1.0"&gt;

&lt;xsl:template match="ctwig:greeting"&gt;
 
  &lt;xsp:logic&gt;
    String msg = "Hello World";
  &lt;/xsp:logic&gt;

  &lt;xsp:expr&gt;msg&lt;/xsp:expr&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match="@*|node()" priority="-1"&gt;
 &lt;xsl:copy&gt;
  &lt;xsl:apply-templates select="@*|node()"/&gt;
 &lt;/xsl:copy&gt;
&lt;/xsl:template&gt;

&lt;/xsl:stylesheet&gt;</pre>
</td><td width="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td>
</tr>
<tr>
<td height="1" width="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td><td height="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td><td height="1" width="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td>
</tr>
</table>
</div>
				
<p align="justify">You will note that the logicsheet has a reference to the ctwig namespace.  This <b>must</b> match the namespace used in the XSP page.  The logicsheet uses a standard XSL template match to find the reference to "ctwig:greeting" and replace it with the logic.</p>
				
<p align="justify">
<i>Again, please note that this example uses "http://apache.org/xsp" as the XSP namespace.  This is different to older C1 based examples and should be used instead.  If you do not then any logicsheet example definitely will not work.</i>
</p>
				
<p align="justify">To make this work firstly make sure that basic3-01.xml in the {TOMCAT_HOME}\webapps\cocoon\ctwig\xsp folder.  This will allow it to be captured by the same sitemap command that is used in the previous examples.  Secondly, make sure that the ctwig logicsheet (ctwig.xsl) is in {TOMCAT_HOME}/webapps/cocoon/WEB-INF/classes/com/pigbite/logicsheets folder.  The final thing to do is to add a reference to the logicsheet source in to C2 so it knows where to go and find it.  This is done by adding the following construct to {TOMCAT_HOME}\webapps\cocoon\cocoon.xconf:</p>
				
<div align="center">
<table border="0" cellpadding="0" cellspacing="4">
<tr>
<td height="1" width="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td><td height="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td><td height="1" width="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td>
</tr>
<tr>
<td width="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td><td bgcolor="#ffffff">
<pre>
  &lt;builtin-logicsheet&gt;
    &lt;parameter name="prefix" value="ctwig"/&gt;
    &lt;parameter name="uri" value="http://www.pigbite.com/xsl"/&gt;
    &lt;parameter name="href" value="resource://com/pigbite/logicsheets/ctwig.xsl"/&gt;
  &lt;/builtin-logicsheet&gt;</pre>
</td><td width="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td>
</tr>
<tr>
<td height="1" width="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td><td height="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td><td height="1" width="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td>
</tr>
</table>
</div>
				
<p align="justify">Here we are using the "resource:" protocol to access the logicsheet.  This logicsheet could sit inside a JAR file that is referenced on the classpath, however it can also sit under the classes folder in the WEB-INF folder, as is the case in this example.</p>
				
<p align="justify">You can also use a "file:" protocol in the form:</p>
				
<div align="center">
<table border="0" cellpadding="0" cellspacing="4">
<tr>
<td height="1" width="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td><td height="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td><td height="1" width="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td>
</tr>
<tr>
<td width="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td><td bgcolor="#ffffff">
<pre>
&lt;parameter
   name="href"
   value="file:///{TOMCAT_HOME}/webapps/cocoon/ctwig/logicsheet/ctwig.xsl"&gt;</pre>
</td><td width="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td>
</tr>
<tr>
<td height="1" width="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td><td height="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td><td height="1" width="1" bgcolor="#0086b2"><img border="0" hspace="0" vspace="0" height="1" width="1" src="images/void.gif"></td>
</tr>
</table>
</div>
				
<p align="justify">Obviously replace {TOMCAT_HOME} with whatever the actual path is on your machine (e.g. d:\java\tomcat).  Note the use of three forward slashes after the "file:".  This is so that it properly refers to the root, you still have to include the drive letter however.</p>
				
<p align="justify">Again, the URI parameter <b>must</b> be the same as the namespace declarations for everything to get properly resolved.</p>
				
<p align="justify">To test this code call <a target="_blank" href="http://localhost:8080/cocoon/ctwig/xsp/basic03-01.xml">http://localhost:8080/cocoon/ctwig/xsp/basic03-01.xml</a>
</p>

			
</font></td>
</tr>
</table>
</div>
<br>
		
</font></td>
</tr>
</table>
</div>
<br>
	

</td>
</tr>
</table>
</td>
</tr>
</table>
<table width="100%" cellspacing="0" cellpadding="0" border="0">
<tr>
<td bgcolor="#0086b2"><img width="1" src="images/dot.gif" height="1"></td>
</tr>
<tr>
<td align="center"><font size="-1" face="arial,helvetica,sanserif" color="#0086b2"><i>Copyright &copy; 1999-2002 The Apache Software Foundation. All Rights Reserved.</i></font></td>
</tr>
</table>
</body>
</html>
